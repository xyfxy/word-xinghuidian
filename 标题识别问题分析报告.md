# 标题识别问题分析报告

## 问题描述
"（一）导师回忆"被识别为一级标题（heading-1），而不是预期的二级标题。

## 原因分析

### 1. 默认启用的规则

查看 `backend/src/constants/wordImportRules.ts` 文件，发现默认启用的规则有：

1. **rule-heading-then-content** (第46行，enabled: true)
   - 标题独立成块，后续内容合并成另一块
   - 适用于标题级别：[1, 2, 3]
   - 优先级：2

2. **rule-chinese-heading-1** (第75行，enabled: true)
   - 识别"一、二、三"格式为一级标题
   - 正则表达式：`^[一二三四五六七八九十]+[、．.]\\s*`
   - 标题级别：1
   - 优先级：1

3. **rule-chinese-heading-2** (第88行，enabled: false) ⚠️ **未启用**
   - 识别"（一）（二）"格式为二级标题
   - 正则表达式：`^[(（][一二三四五六七八九十]+[)）]\\s*`
   - 标题级别：2
   - 优先级：6

### 2. 问题根源

**"（一）导师回忆"之所以被识别为一级标题，是因为：**

1. **rule-chinese-heading-2** 规则虽然定义了，但是 **默认未启用**（enabled: false）
2. Word文档解析时，如果文本在Word中被设置为"标题"样式，会被识别为标题类型
3. 由于没有启用二级标题的规则，系统只能应用默认的标题处理逻辑

### 3. 解析流程分析

根据代码分析，解析流程如下：

1. **EnhancedWordParserService** 解析Word文档时（第339-359行）：
   - 首先检查段落是否有 `outlineLvl` 属性（Word的标准标题标记）
   - 然后检查样式名称是否包含"Heading"或"标题"
   - 如果符合条件，将其标记为标题类型

2. **ContentGrouper** 应用规则时（第108-123行）：
   - 对于 `heading-pattern` 类型的规则，会将匹配的段落转换为标题
   - 但由于 rule-chinese-heading-2 未启用，所以"（一）导师回忆"不会被此规则处理

3. **最终结果**：
   - 如果"（一）导师回忆"在Word中被设置为标题样式，会被识别为标题
   - 由于没有相应的规则来确定其级别，可能使用了默认级别或从Word样式中提取的级别

## 解决方案

### 方案1：启用二级标题规则
修改 `backend/src/constants/wordImportRules.ts` 第88行：
```typescript
enabled: true,  // 从 false 改为 true
```

### 方案2：检查Word文档样式
1. 确认"（一）导师回忆"在Word中的样式设置
2. 如果被设置为"标题1"样式，需要改为"标题2"或普通文本样式

### 方案3：自定义规则优先级
如果需要更精确的控制，可以：
1. 调整规则的优先级
2. 修改规则的正则表达式
3. 添加更多的识别条件

## 建议

1. **立即修复**：启用 rule-chinese-heading-2 规则
2. **长期优化**：
   - 添加规则冲突检测机制
   - 提供规则测试工具
   - 在UI中显示当前启用的规则及其效果
   - 允许用户实时预览不同规则组合的效果