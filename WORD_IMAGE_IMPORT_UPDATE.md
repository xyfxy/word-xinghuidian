# Word图片导入功能更新说明

## 功能概述

已成功实现Word文档中图片的识别、提取和导入功能。导入的图片会作为独立的图片内容块显示在模板中，而不是作为固定文本内容的一部分。

## 实现细节

### 1. 后端更新

#### Word解析服务 (`enhancedWordParserService.ts`)
- 添加了关系映射构建，用于解析Word文档中的图片引用关系
- 支持两种图片格式：
  - 现代格式：`w:drawing` (Office 2007+)
  - 旧版格式：`w:pict` (Office 2003及更早版本)
- 提取图片数据为base64格式，保留原始尺寸和alt文本信息

#### 路由处理 (`wordImport.ts`)
- 识别纯图片内容组，将其转换为`image`类型的内容块
- 图片内容块包含完整的`ImageContent`对象，支持：
  - 图片源(src)
  - 尺寸(width/height)
  - 对齐方式(alignment)
  - 标题(caption)
  - 边框设置(border)

### 2. 前端更新

#### 文档结构编辑器 (`DocumentStructureEditor.tsx`)
- 添加图片元素的显示支持
- 图片元素使用紫色标签标识
- 显示图片缩略图（最大高度200px）
- 显示alt文本作为描述

#### 类型定义同步
- 前后端的`ParsedElement`接口都添加了`imageData`属性
- 确保图片数据在整个处理流程中正确传递

## 使用方式

1. **上传包含图片的Word文档**
   - 支持.docx和.doc格式
   - 图片会被自动识别和提取

2. **在文档结构编辑器中查看**
   - 图片显示为独立的元素
   - 可以看到图片预览和相关信息

3. **生成模板**
   - 单独的图片会创建为图片内容块
   - 图片与文本混合的段落会作为文本内容块（图片嵌入HTML中）

4. **在模板编辑器中**
   - 图片内容块显示为独立的块
   - 可以选择是"固定内容"还是"AI生成"
   - 支持调整图片属性（大小、对齐、边框等）

## 测试方法

1. 准备测试文档：
   ```
   backend/test-docs/test-with-images.docx
   ```
   包含文本和图片内容

2. 运行测试脚本：
   ```bash
   cd backend
   node test-image-import.js
   ```

3. 通过Web界面测试：
   - 上传包含图片的Word文档
   - 查看导入结果
   - 保存为模板并编辑

## 注意事项

- 图片以base64格式存储，大图片可能影响性能
- 建议在Word文档中使用适当大小的图片
- 图片的原始尺寸会被保留，但在预览中会限制最大高度